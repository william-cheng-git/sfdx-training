<?xml version="1.0" encoding="UTF-8" ?>
<ruleset
  name="William's Custom Apex PMD Ruleset"
  xmlns="http://pmd.sourceforge.net/ruleset/2.0.0"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://pmd.sourceforge.net/ruleset/2.0.0 https://pmd.github.io/pmd-6.0.x/pmd-ruleset_2_0_0.xsd"
>

    <description>
        This is William's custom ruleset for Apex code.
    </description>

  <!-- Standard rules with custom property -->
   <rule
    ref="category/apex/bestpractices.xml/ApexUnitTestClassShouldHaveAsserts"
    message="Apex unit test classes should have at least one System.assert() or Assert.xxx() or Expect.xxx() call"
  >
      <priority>3</priority>
      <properties>
         <property
        name="additionalAssertMethodPattern"
        value="((System\.Assert|Assert|Expect)\.\w+)"
      />
      </properties>
   </rule>

   <!-- Custom rules -->
  <rule
    name="ApiVersionTooLow"
    language="xml"
    message="apiVersion lower than min allowed API version"
    class="net.sourceforge.pmd.lang.xml.rule.DomXPathRule"
  >
    <priority>1</priority>
    <properties>
      <property
        name="minAPIVersion"
        type="Double"
        value="64"
        description="Minimium API version allowed"
      />
      <property name="xpath">
        <value
        ><![CDATA[
          //*[local-name()='apiVersion'][ number(normalize-space(.)) < $minAPIVersion]
        ]]></value>
      </property>
    </properties>
  </rule>
</ruleset>
